// Vibe Olympics - Prisma Schema
// VIBE ì½”ë”© ê¸°ë°˜ ì§€ì‹ì¬ì‚° ë§ˆì¼“í”Œë ˆì´ìŠ¤

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// ==========================================
// NextAuth.js ì¸ì¦ ê´€ë ¨ ëª¨ë¸
// ==========================================

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

// ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • í† í°
model PasswordResetToken {
  id        String   @id @default(cuid())
  email     String
  token     String   @unique
  expires   DateTime
  createdAt DateTime @default(now())

  @@unique([email, token])
  @@index([email])
}

// ==========================================
// ì‚¬ìš©ì ê¶Œí•œ Enum
// ==========================================

enum UserRole {
  USER
  ADMIN
}

// ==========================================
// ì‚¬ìš©ì ëª¨ë¸
// ==========================================

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  emailVerified DateTime?
  name          String?
  image         String?
  password      String?   // ì´ë©”ì¼ ë¡œê·¸ì¸ìš©
  role          UserRole  @default(USER)  // ì‚¬ìš©ì ê¶Œí•œ
  
  // í”„ë¡œí•„ ì •ë³´
  bio           String?   @db.Text
  website       String?
  github        String?
  twitter       String?
  
  // ì•„í‹°ìŠ¤íŠ¸/ì‘ê°€ í”„ë¡œí•„ í™•ì¥
  displayName   String?           // í‘œì‹œ ì´ë¦„ (ì˜ˆëª…/í•„ëª…)
  slug          String?   @unique // í”„ë¡œí•„ URL slug
  coverImage    String?           // í”„ë¡œí•„ ì»¤ë²„ ì´ë¯¸ì§€
  artistType    String?           // ì•„í‹°ìŠ¤íŠ¸ íƒ€ì… (ì‘ê°€, ë®¤ì§€ì…˜, í¬ë¦¬ì—ì´í„° ë“±)
  specialties   String[]          // ì „ë¬¸ ë¶„ì•¼
  location      String?           // ìœ„ì¹˜/ì§€ì—­
  instagram     String?           // ì¸ìŠ¤íƒ€ê·¸ë¨
  youtube       String?           // ìœ íŠœë¸Œ
  linkedin      String?           // ë§í¬ë“œì¸
  soundcloud    String?           // ì‚¬ìš´ë“œí´ë¼ìš°ë“œ (ìŒì•…)
  behance       String?           // ë¹„í•¸ìŠ¤ (ë””ìì¸)
  isVerifiedArtist Boolean @default(false) // ì¸ì¦ëœ ì•„í‹°ìŠ¤íŠ¸
  
  // íŒë§¤ì ì •ë³´
  isSeller      Boolean   @default(false)
  sellerVerified Boolean  @default(false)
  sellerBio     String?   @db.Text
  
  // ì•Œë¦¼ ì„¤ì • (JSON)
  notificationSettings Json?
  
  // í†µê³„
  totalSales    Int       @default(0)
  totalRevenue  Decimal   @default(0) @db.Decimal(12, 2)
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // ê´€ê³„
  accounts      Account[]
  sessions      Session[]
  products      Product[]         // íŒë§¤ ìƒí’ˆ
  purchases     Purchase[]        // êµ¬ë§¤ ë‚´ì—­
  reviews       Review[]          // ì‘ì„±í•œ ë¦¬ë·°
  wishlists     Wishlist[]        // ìœ„ì‹œë¦¬ìŠ¤íŠ¸
  notifications Notification[]    // ì•Œë¦¼
  pushSubscriptions PushSubscription[] // í‘¸ì‹œ ì•Œë¦¼ êµ¬ë…
  posts         Post[]            // ì‘ì„±í•œ ê²Œì‹œê¸€
  comments      Comment[]         // ì‘ì„±í•œ ëŒ“ê¸€
  postLikes     PostLike[]        // ì¢‹ì•„ìš”í•œ ê²Œì‹œê¸€
  tutorials     Tutorial[]        // ì‘ì„±í•œ íŠœí† ë¦¬ì–¼
  tutorialLikes TutorialLike[]    // ì¢‹ì•„ìš”í•œ íŠœí† ë¦¬ì–¼
  
  // í†µí•© ë°˜ì‘ ì‹œìŠ¤í…œ
  reactions        Reaction[]        // ë°˜ì‘ (ì¢‹ì•„ìš”/ì¶”ì²œ/ë¶ë§ˆí¬)
  unifiedComments  UnifiedComment[]  // í†µí•© ëŒ“ê¸€
  
  // íŒ”ë¡œìš° ì‹œìŠ¤í…œ
  followers     Follow[]  @relation("Following")  // ë‚˜ë¥¼ íŒ”ë¡œìš°í•˜ëŠ” ì‚¬ëŒë“¤
  following     Follow[]  @relation("Followers")  // ë‚´ê°€ íŒ”ë¡œìš°í•˜ëŠ” ì‚¬ëŒë“¤
  
  // ì •ì‚° ì‹œìŠ¤í…œ
  settlements      Settlement[]      // ì •ì‚° ë‚´ì—­ (íŒë§¤ì)
  refundRequests   RefundRequest[]   // í™˜ë¶ˆ ìš”ì²­ (êµ¬ë§¤ì)
  
  // ì»¬ë ‰ì…˜ ì‹œìŠ¤í…œ
  collections      Collection[]      // íŒë§¤ìì˜ ì»¬ë ‰ì…˜
  
  // êµ¬ë… ì‹œìŠ¤í…œ
  subscriptions    Subscription[]                      // ë‚´ êµ¬ë…
  subscriptionPlans SubscriptionPlan[] @relation("SellerSubscriptionPlans") // ë‚´ê°€ ë§Œë“  êµ¬ë… í”Œëœ (íŒë§¤ì)
  
  // ì¶”ì²œ ì‹œìŠ¤í…œ
  userCluster      UserCluster?      // ì‚¬ìš©ì í´ëŸ¬ìŠ¤í„° ì •ë³´
  
  // A/B í…ŒìŠ¤íŠ¸ ì‹œìŠ¤í…œ
  experiments      Experiment[]      // ìƒì„±í•œ ì‹¤í—˜
  
  @@index([email])
}

// ==========================================
// íŒ”ë¡œìš° ëª¨ë¸
// ==========================================

model Follow {
  id          String   @id @default(cuid())
  
  // íŒ”ë¡œì›Œ (íŒ”ë¡œìš° í•˜ëŠ” ì‚¬ëŒ)
  followerId  String
  follower    User     @relation("Followers", fields: [followerId], references: [id], onDelete: Cascade)
  
  // íŒ”ë¡œì‰ (íŒ”ë¡œìš° ë‹¹í•˜ëŠ” ì‚¬ëŒ)
  followingId String
  following   User     @relation("Following", fields: [followingId], references: [id], onDelete: Cascade)
  
  createdAt   DateTime @default(now())
  
  // ê°™ì€ ì‚¬ëŒì„ ì¤‘ë³µ íŒ”ë¡œìš° ë¶ˆê°€
  @@unique([followerId, followingId])
  @@index([followerId])
  @@index([followingId])
}

// ==========================================
// ìƒí’ˆ ëª¨ë¸
// ==========================================

// ìƒí’ˆ íƒ€ì… (ì½˜í…ì¸  ë¶„ë¥˜)
enum ProductType {
  DIGITAL_PRODUCT   // ê¸°ì¡´ ë””ì§€í„¸ ìƒí’ˆ (í…œí”Œë¦¿, ë„êµ¬ ë“±)
  BOOK              // ë„ì„œ (ë§Œí™”ì±…, ì „ìì±…, ë™í™”ì±…, ì¢…ì´ì±…)
  VIDEO_SERIES      // ì˜ìƒ ì‹œë¦¬ì¦ˆ (ì˜í™”, ì• ë‹ˆë©”ì´ì…˜)
  MUSIC_ALBUM       // ìŒì•… ì•¨ë²”
}

// ë„ì„œ ìœ í˜•
enum BookType {
  EBOOK             // ì „ìì±…
  COMIC             // ë§Œí™”ì±…
  PICTURE_BOOK      // ë™í™”ì±…/ê·¸ë¦¼ì±…
  PRINT_BOOK        // ì¢…ì´ì±…
  AUDIO_BOOK        // ì˜¤ë””ì˜¤ë¶
}

// ì˜ìƒ ì‹œë¦¬ì¦ˆ ìœ í˜•
enum VideoSeriesType {
  MOVIE             // ì˜í™”
  ANIMATION         // ì• ë‹ˆë©”ì´ì…˜
  DOCUMENTARY       // ë‹¤íë©˜í„°ë¦¬
  SHORT_FILM        // ë‹¨í¸
  SERIES            // ì‹œë¦¬ì¦ˆë¬¼
}

// ìŒì•… ì¥ë¥´
enum MusicGenre {
  POP               // íŒ
  ROCK              // ë¡
  HIPHOP            // í™í•©
  RNB               // R&B
  ELECTRONIC        // ì¼ë ‰íŠ¸ë¡œë‹‰
  CLASSICAL         // í´ë˜ì‹
  JAZZ              // ì¬ì¦ˆ
  AMBIENT           // ì•°ë¹„ì–¸íŠ¸
  SOUNDTRACK        // ì‚¬ìš´ë“œíŠ¸ë™
  WORLD             // ì›”ë“œë®¤ì§
  OTHER             // ê¸°íƒ€
}

model Category {
  id          String    @id @default(cuid())
  name        String    @unique
  slug        String    @unique
  description String?
  icon        String?
  color       String?
  sortOrder   Int       @default(0)
  
  // ìƒìœ„ ì¹´í…Œê³ ë¦¬ (ê³„ì¸µ êµ¬ì¡°)
  parentId    String?
  parent      Category? @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children    Category[] @relation("CategoryHierarchy")
  
  // ì–´ë–¤ ìƒí’ˆ íƒ€ì…ì— ì†í•˜ëŠ” ì¹´í…Œê³ ë¦¬ì¸ì§€
  productType ProductType @default(DIGITAL_PRODUCT)
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  products    Product[]
  
  @@index([slug])
  @@index([parentId])
  @@index([productType])
}

model Product {
  id              String   @id @default(cuid())
  
  // ê¸°ë³¸ ì •ë³´
  title           String
  slug            String   @unique
  shortDescription String  @db.VarChar(200)
  description     String   @db.Text  // Markdown
  
  // ìƒí’ˆ íƒ€ì… (ì½˜í…ì¸  ë¶„ë¥˜)
  productType     ProductType @default(DIGITAL_PRODUCT)
  
  // ì¹´í…Œê³ ë¦¬
  categoryId      String
  category        Category @relation(fields: [categoryId], references: [id])
  
  // íŒë§¤ì
  sellerId        String
  seller          User     @relation(fields: [sellerId], references: [id], onDelete: Cascade)
  
  // ê°€ê²©
  pricingType     PricingType @default(PAID)
  price           Decimal     @default(0) @db.Decimal(10, 2)
  originalPrice   Decimal?    @db.Decimal(10, 2)  // í• ì¸ ì „ ê°€ê²©
  
  // ë¼ì´ì„ ìŠ¤
  licenseType     LicenseType @default(PERSONAL)
  
  // ë¯¸ë””ì–´
  thumbnail       String?
  images          String[]    // JSON array of image URLs
  previewUrl      String?     // ë¯¸ë¦¬ë³´ê¸° URL (ì˜ìƒ/ìŒì•…)
  
  // íŒŒì¼
  files           ProductFile[]
  
  // íƒœê·¸
  tags            String[]
  
  // ê¸°ëŠ¥ ëª©ë¡
  features        String[]
  
  // ê¸°ìˆ  ìŠ¤íƒ
  techStack       String[]
  
  // AI ìƒì„± ì •ë³´
  isAiGenerated   Boolean   @default(false)
  aiTool          String?   // ì‚¬ìš©ëœ AI ë„êµ¬ (ì˜ˆ: Midjourney, Suno, Runway)
  aiPrompt        String?   @db.Text  // AI í”„ë¡¬í”„íŠ¸ (ê³µê°œìš©)
  
  // ìƒíƒœ
  status          ProductStatus @default(DRAFT)
  isPublished     Boolean       @default(false)
  publishedAt     DateTime?
  
  // í†µê³„
  viewCount       Int       @default(0)
  salesCount      Int       @default(0)
  downloadCount   Int       @default(0)
  averageRating   Float     @default(0)
  reviewCount     Int       @default(0)
  
  // ë©”íƒ€
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  // ê´€ê³„
  purchases       Purchase[]
  reviews         Review[]
  wishlists       Wishlist[]
  tutorials       ProductTutorial[]  // ì—°ê²°ëœ íŠœí† ë¦¬ì–¼
  collectionItems CollectionItem[]   // ì»¬ë ‰ì…˜ ì•„ì´í…œ
  
  // ë¯¸ë””ì–´ë³„ ë©”íƒ€ë°ì´í„° (1:1 ê´€ê³„)
  bookMeta        BookMeta?
  videoSeriesMeta VideoSeriesMeta?
  musicAlbumMeta  MusicAlbumMeta?
  
  @@index([sellerId])
  @@index([categoryId])
  @@index([slug])
  @@index([status, isPublished])
  @@index([createdAt])
  @@index([productType])
  @@index([isAiGenerated])
}

model ProductFile {
  id          String   @id @default(cuid())
  productId   String
  product     Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  name        String
  url         String
  size        Int      // bytes
  type        String   // MIME type
  
  createdAt   DateTime @default(now())
  
  @@index([productId])
}

// ==========================================
// ë¯¸ë””ì–´ë³„ ë©”íƒ€ë°ì´í„° ëª¨ë¸
// ==========================================

// ë„ì„œ ë©”íƒ€ë°ì´í„°
model BookMeta {
  id          String    @id @default(cuid())
  productId   String    @unique
  product     Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  // ë„ì„œ ì •ë³´
  bookType    BookType  @default(EBOOK)
  author      String?                    // ì €ì (AI ë˜ëŠ” ì‚¬ëŒ)
  publisher   String?                    // ì¶œíŒì‚¬
  isbn        String?                    // ISBN (ì¢…ì´ì±…)
  
  // ì½˜í…ì¸  ì •ë³´
  pageCount   Int?                       // í˜ì´ì§€ ìˆ˜
  chapters    Int?                       // ì±•í„° ìˆ˜
  language    String    @default("ko")   // ì–¸ì–´
  
  // ì „ìì±… í˜•ì‹
  format      String[]                   // PDF, EPUB, MOBI ë“±
  
  // ì—°ë ¹ ë“±ê¸‰
  ageRating   String?                    // ì „ì²´ì´ìš©ê°€, 12ì„¸, 15ì„¸, 19ì„¸
  
  // ì‹œë¦¬ì¦ˆ ì •ë³´
  seriesName  String?                    // ì‹œë¦¬ì¦ˆëª…
  seriesOrder Int?                       // ì‹œë¦¬ì¦ˆ ë‚´ ìˆœì„œ
  
  // ìƒ˜í”Œ
  sampleUrl   String?                    // ë¯¸ë¦¬ë³´ê¸° ìƒ˜í”Œ
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  @@index([bookType])
  @@index([seriesName])
}

// ì˜ìƒ ì‹œë¦¬ì¦ˆ ë©”íƒ€ë°ì´í„°
model VideoSeriesMeta {
  id          String    @id @default(cuid())
  productId   String    @unique
  product     Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  // ì˜ìƒ ì •ë³´
  videoType   VideoSeriesType @default(MOVIE)
  director    String?                    // ê°ë…
  cast        String[]                   // ì¶œì—°ì§„/ìºë¦­í„°
  
  // ì½˜í…ì¸  ì •ë³´
  duration    Int?                       // ì´ ëŸ¬ë‹íƒ€ì„ (ë¶„)
  episodes    Int?                       // ì—í”¼ì†Œë“œ ìˆ˜ (ì‹œë¦¬ì¦ˆ)
  seasons     Int?                       // ì‹œì¦Œ ìˆ˜
  
  // ê¸°ìˆ  ì •ë³´
  resolution  String?                    // 4K, 1080p, 720p
  audioFormat String?                    // Stereo, 5.1, Dolby Atmos
  subtitles   String[]                   // ìë§‰ ì–¸ì–´ë“¤
  
  // ë“±ê¸‰
  ageRating   String?                    // ì „ì²´, 12ì„¸, 15ì„¸, ì²­ë¶ˆ
  
  // ì¥ë¥´
  genre       String[]                   // ì•¡ì…˜, ë¡œë§¨ìŠ¤, SF ë“±
  
  // íŠ¸ë ˆì¼ëŸ¬
  trailerUrl  String?                    // ì˜ˆê³ í¸ URL
  
  // ì‹œë¦¬ì¦ˆ ì •ë³´
  seriesName  String?
  seriesOrder Int?
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  @@index([videoType])
  @@index([seriesName])
}

// ìŒì•… ì•¨ë²” ë©”íƒ€ë°ì´í„°
model MusicAlbumMeta {
  id          String    @id @default(cuid())
  productId   String    @unique
  product     Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  // ì•¨ë²” ì •ë³´
  artist      String?                    // ì•„í‹°ìŠ¤íŠ¸ëª…
  albumType   String?                    // Single, EP, Full Album, Compilation
  
  // ì¥ë¥´
  genre       MusicGenre @default(OTHER)
  subGenre    String?                    // ì„¸ë¶€ ì¥ë¥´
  mood        String[]                   // ë¶„ìœ„ê¸° íƒœê·¸ (chill, energetic, melancholic)
  
  // íŠ¸ë™ ì •ë³´
  trackCount  Int?                       // íŠ¸ë™ ìˆ˜
  totalDuration Int?                     // ì´ ì¬ìƒì‹œê°„ (ì´ˆ)
  
  // ìŒì› ì •ë³´
  format      String[]                   // MP3, FLAC, WAV
  bitrate     String?                    // 320kbps, Lossless
  sampleRate  String?                    // 44.1kHz, 48kHz, 96kHz
  
  // í…Œë§ˆ
  theme       String?                    // í…Œë§ˆ (ì‘ì—…ìš©, ìˆ˜ë©´ìš©, ìš´ë™ìš©)
  
  // ê°€ì‚¬
  hasLyrics   Boolean   @default(false)  // ê°€ì‚¬ í¬í•¨ ì—¬ë¶€
  isInstrumental Boolean @default(false) // ì¸ìŠ¤íŠ¸ë£¨ë©˜íƒˆ
  
  // ë¯¸ë¦¬ë“£ê¸°
  previewTracks String[]                 // ë¯¸ë¦¬ë“£ê¸° íŠ¸ë™ URLë“¤
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  @@index([genre])
  @@index([theme])
}

// ==========================================
// ì»¬ë ‰ì…˜ ëª¨ë¸ (ìƒí’ˆ ë¬¶ìŒ/ì‹œë¦¬ì¦ˆ)
// ==========================================

// ì»¬ë ‰ì…˜ ìœ í˜•
enum CollectionType {
  SERIES        // ì‹œë¦¬ì¦ˆ (ìˆœì°¨ì  êµ¬ì„±)
  BUNDLE        // ë²ˆë“¤ (ì„¸íŠ¸ ìƒí’ˆ)
  PLAYLIST      // í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ (ìŒì•…ìš©)
  CURATED       // íë ˆì´ì…˜ (ì„ ë³„ëœ ìƒí’ˆ ëª¨ìŒ)
}

model Collection {
  id            String    @id @default(cuid())
  
  // ì†Œìœ ì (íŒë§¤ì)
  sellerId      String
  seller        User      @relation(fields: [sellerId], references: [id], onDelete: Cascade)
  
  // ê¸°ë³¸ ì •ë³´
  title         String
  slug          String    @unique
  description   String?   @db.Text
  thumbnail     String?
  
  // ì»¬ë ‰ì…˜ ìœ í˜•
  type          CollectionType @default(BUNDLE)
  
  // ìƒí’ˆ ìœ í˜• (ì»¬ë ‰ì…˜ ë‚´ ìƒí’ˆ ìœ í˜• í†µì¼ì„ ìœ„í•´)
  productType   ProductType?
  
  // ê°€ê²©/í• ì¸
  bundlePrice   Decimal?  @db.Decimal(10, 2)  // ë²ˆë“¤ ê°€ê²© (ê°œë³„ êµ¬ë§¤ë³´ë‹¤ ì €ë ´)
  discountRate  Int?      // í• ì¸ìœ¨ (%)
  
  // ìƒíƒœ
  isPublished   Boolean   @default(false)
  isFeatured    Boolean   @default(false)
  
  // í†µê³„
  viewCount     Int       @default(0)
  salesCount    Int       @default(0)
  
  // SEO
  seoSlug       String?
  metaDescription String? @db.VarChar(160)
  metaKeywords  String[]
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  // ê´€ê³„
  items         CollectionItem[]
  
  @@index([sellerId])
  @@index([type])
  @@index([productType])
  @@index([isPublished, isFeatured])
  @@index([slug])
}

model CollectionItem {
  id            String    @id @default(cuid())
  
  // ì»¬ë ‰ì…˜
  collectionId  String
  collection    Collection @relation(fields: [collectionId], references: [id], onDelete: Cascade)
  
  // ìƒí’ˆ
  productId     String
  product       Product    @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  // ìˆœì„œ (ì‹œë¦¬ì¦ˆì˜ ê²½ìš° ìˆœì„œ ì¤‘ìš”)
  order         Int       @default(0)
  
  // ê°œë³„ í• ì¸ (ë²ˆë“¤ ë‚´ íŠ¹ì • ìƒí’ˆ ì¶”ê°€ í• ì¸)
  itemDiscountRate Int?
  
  // í•„ìˆ˜ ì—¬ë¶€ (ë²ˆë“¤ì—ì„œ í•„ìˆ˜ í¬í•¨ ìƒí’ˆ)
  isRequired    Boolean   @default(true)
  
  createdAt     DateTime  @default(now())
  
  @@unique([collectionId, productId])
  @@index([collectionId])
  @@index([productId])
  @@index([order])
}

// ==========================================
// êµ¬ë§¤ ëª¨ë¸
// ==========================================

model Purchase {
  id            String   @id @default(cuid())
  
  // êµ¬ë§¤ì
  buyerId       String
  buyer         User     @relation(fields: [buyerId], references: [id], onDelete: Cascade)
  
  // ìƒí’ˆ
  productId     String
  product       Product  @relation(fields: [productId], references: [id])
  
  // ê²°ì œ ì •ë³´
  amount        Decimal  @db.Decimal(10, 2)
  currency      String   @default("KRW")
  paymentMethod String?
  paymentId     String?  // ì™¸ë¶€ ê²°ì œ ì‹œìŠ¤í…œ ID
  
  // ë²ˆë“¤ êµ¬ë§¤ ê´€ë ¨
  bundleId      String?  // ë²ˆë“¤ë¡œ êµ¬ë§¤í•œ ê²½ìš° ì»¬ë ‰ì…˜ ID
  bundleDiscount Decimal? @db.Decimal(10, 2)  // ë²ˆë“¤ í• ì¸ ê¸ˆì•¡
  
  // ìƒíƒœ
  status        PurchaseStatus @default(PENDING)
  
  // ë‹¤ìš´ë¡œë“œ
  downloadCount Int      @default(0)
  lastDownloadAt DateTime?
  
  // ì •ì‚° ê´€ë ¨
  isSettled     Boolean  @default(false)  // ì •ì‚° ì™„ë£Œ ì—¬ë¶€
  settledAt     DateTime?                 // ì •ì‚° ì™„ë£Œì¼
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  // ì •ì‚°/í™˜ë¶ˆ ê´€ê³„
  settlementItems SettlementItem[]
  refundRequests  RefundRequest[]
  
  @@unique([buyerId, productId])
  @@index([buyerId])
  @@index([productId])
  @@index([status])
  @@index([isSettled])
  @@index([bundleId])
}

// ==========================================
// ë¦¬ë·° ëª¨ë¸
// ==========================================

model Review {
  id          String   @id @default(cuid())
  
  // ì‘ì„±ì
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // ìƒí’ˆ
  productId   String
  product     Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  // ë‚´ìš©
  rating      Int      // 1-5
  title       String?
  content     String   @db.Text
  
  // ì´ë¯¸ì§€ (ìµœëŒ€ 5ê°œ)
  images      Json?    // ["url1", "url2", ...]
  
  // ë„ì›€ë¨ í‘œì‹œ
  helpfulCount Int     @default(0)
  
  // íŒë§¤ì ë‹µë³€
  sellerReply String?  @db.Text
  sellerRepliedAt DateTime?
  
  // ê²€ì¦ëœ êµ¬ë§¤ì ë¦¬ë·°
  isVerifiedPurchase Boolean @default(true)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // ê´€ê³„
  helpfulVotes ReviewHelpful[]
  
  @@unique([userId, productId])
  @@index([productId])
  @@index([userId])
  @@index([rating])
}

// ë¦¬ë·° ë„ì›€ë¨ íˆ¬í‘œ ëª¨ë¸
model ReviewHelpful {
  id        String   @id @default(cuid())
  
  reviewId  String
  review    Review   @relation(fields: [reviewId], references: [id], onDelete: Cascade)
  
  userId    String
  
  createdAt DateTime @default(now())
  
  @@unique([reviewId, userId])
  @@index([reviewId])
  @@index([userId])
}

// ==========================================
// ìœ„ì‹œë¦¬ìŠ¤íŠ¸ ëª¨ë¸
// ==========================================

model Wishlist {
  id          String   @id @default(cuid())
  
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  productId   String
  product     Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  createdAt   DateTime @default(now())
  
  @@unique([userId, productId])
  @@index([userId])
  @@index([productId])
}

// ==========================================
// ì•Œë¦¼ ëª¨ë¸
// ==========================================

model Notification {
  id          String   @id @default(cuid())
  
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  type        NotificationType
  title       String
  message     String   @db.Text
  data        Json?    // ì¶”ê°€ ë°ì´í„°
  
  isRead      Boolean  @default(false)
  readAt      DateTime?
  
  createdAt   DateTime @default(now())
  
  @@index([userId])
  @@index([isRead])
  @@index([createdAt])
}

// ==========================================
// í‘¸ì‹œ ì•Œë¦¼ êµ¬ë… ëª¨ë¸
// ==========================================

model PushSubscription {
  id          String   @id @default(cuid())
  
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Web Push API êµ¬ë… ì •ë³´
  endpoint    String   @db.Text
  p256dh      String?  // Public Key
  auth        String?  // Auth Secret
  
  // ë©”íƒ€ë°ì´í„°
  userAgent   String?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@unique([userId, endpoint])
  @@index([userId])
}

// ==========================================
// Enum ì •ì˜
// ==========================================

enum PricingType {
  FREE
  PAID
}

enum LicenseType {
  PERSONAL        // ê°œì¸ìš©
  COMMERCIAL      // ìƒì—…ìš© (1ì¸)
  EXTENDED        // í™•ì¥ ë¼ì´ì„ ìŠ¤ (íŒ€/ê¸°ì—…)
}

enum ProductStatus {
  DRAFT           // ì‘ì„± ì¤‘
  PENDING_REVIEW  // ê²€í†  ëŒ€ê¸°
  PUBLISHED       // ê²Œì‹œë¨
  REJECTED        // ê±°ë¶€ë¨
  SUSPENDED       // ì¼ì‹œ ì¤‘ì§€
}

enum PurchaseStatus {
  PENDING         // ê²°ì œ ëŒ€ê¸°
  COMPLETED       // ì™„ë£Œ
  FAILED          // ê²°ì œ ì‹¤íŒ¨
  REFUNDED        // í™˜ë¶ˆë¨
  CANCELLED       // ì·¨ì†Œë¨
}

enum NotificationType {
  PURCHASE        // êµ¬ë§¤ ì™„ë£Œ ì•Œë¦¼
  SALE            // íŒë§¤ ì•Œë¦¼
  REVIEW          // ë¦¬ë·° ì•Œë¦¼
  SYSTEM          // ì‹œìŠ¤í…œ ì•Œë¦¼
  PROMOTION       // í”„ë¡œëª¨ì…˜
  FOLLOWER        // ìƒˆ íŒ”ë¡œì›Œ
  COMMENT         // ìƒˆ ëŒ“ê¸€
  WISHLIST        // ìœ„ì‹œë¦¬ìŠ¤íŠ¸ ê´€ë ¨
  PRODUCT_UPDATE  // ìƒí’ˆ ì—…ë°ì´íŠ¸
}

// ==========================================
// ì»¤ë®¤ë‹ˆí‹° ëª¨ë¸
// ==========================================

model Post {
  id          String   @id @default(cuid())
  
  // ì‘ì„±ì
  authorId    String
  author      User     @relation(fields: [authorId], references: [id], onDelete: Cascade)
  
  // ë‚´ìš©
  category    PostCategory @default(FREE)
  title       String   @db.VarChar(200)
  content     String   @db.Text
  
  // í†µê³„
  viewCount   Int      @default(0)
  likeCount   Int      @default(0)
  
  // ìƒíƒœ
  isPinned    Boolean  @default(false)
  isDeleted   Boolean  @default(false)
  isPublished Boolean  @default(true)     // ì˜ˆì•½ ë°œí–‰ìš©
  scheduledAt DateTime?                   // ì˜ˆì•½ ë°œí–‰ ì¼ì‹œ
  publishedAt DateTime?                   // ì‹¤ì œ ë°œí–‰ ì¼ì‹œ
  
  // ë©”íƒ€
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // ê´€ê³„
  comments    Comment[]
  likes       PostLike[]
  
  @@index([authorId])
  @@index([category])
  @@index([createdAt])
  @@index([isPinned, createdAt])
  @@index([isPublished, scheduledAt])
}

model Comment {
  id          String   @id @default(cuid())
  
  // ì‘ì„±ì
  authorId    String
  author      User     @relation(fields: [authorId], references: [id], onDelete: Cascade)
  
  // ê²Œì‹œê¸€
  postId      String
  post        Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  
  // ëŒ€ëŒ“ê¸€ (ì„ íƒ)
  parentId    String?
  parent      Comment? @relation("CommentReplies", fields: [parentId], references: [id], onDelete: Cascade)
  replies     Comment[] @relation("CommentReplies")
  
  // ë‚´ìš©
  content     String   @db.Text
  
  // ìƒíƒœ
  isDeleted   Boolean  @default(false)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([postId])
  @@index([authorId])
  @@index([parentId])
}

model PostLike {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  postId    String
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  
  @@unique([userId, postId])
  @@index([postId])
}

enum PostCategory {
  FREE            // ììœ ê²Œì‹œíŒ
  QA              // Q&A
  FEEDBACK        // í”¼ë“œë°±
  NOTICE          // ê³µì§€ì‚¬í•­
}

// ==========================================
// êµìœ¡ ì„¼í„° ëª¨ë¸
// ==========================================

model Tutorial {
  id            String   @id @default(cuid())
  
  // ì‘ì„±ì
  authorId      String
  author        User     @relation(fields: [authorId], references: [id], onDelete: Cascade)
  
  // ê¸°ë³¸ ì •ë³´
  title         String   @db.VarChar(200)
  slug          String   @unique
  description   String   @db.Text
  content       String   @db.Text  // Markdown
  
  // ìœ í˜•
  type          TutorialType @default(TUTORIAL)
  
  // ë¯¸ë””ì–´
  thumbnail     String?
  videoUrl      String?       // ìœ íŠœë¸Œ, Vimeo ë“±
  externalUrl   String?       // ì™¸ë¶€ ìë£Œ ë§í¬
  
  // ë©”íƒ€ ì •ë³´
  duration      Int?          // ë¶„ ë‹¨ìœ„
  tags          String[]
  
  // ìƒíƒœ
  isFeatured    Boolean  @default(false)
  isPublished   Boolean  @default(false)
  publishedAt   DateTime?
  
  // í†µê³„
  viewCount     Int      @default(0)
  likeCount     Int      @default(0)
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  // ê´€ê³„
  likes         TutorialLike[]
  products      ProductTutorial[]  // ì—°ê²°ëœ ìƒí’ˆ
  
  @@index([authorId])
  @@index([type])
  @@index([slug])
  @@index([isPublished, isFeatured])
  @@index([createdAt])
}

// ìƒí’ˆ-íŠœí† ë¦¬ì–¼ ì—°ê²° ëª¨ë¸ (ë‹¤ëŒ€ë‹¤)
model ProductTutorial {
  id          String   @id @default(cuid())
  
  // ìƒí’ˆ
  productId   String
  product     Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  // íŠœí† ë¦¬ì–¼
  tutorialId  String
  tutorial    Tutorial @relation(fields: [tutorialId], references: [id], onDelete: Cascade)
  
  // ì—°ê²° ìœ í˜•
  type        ProductTutorialType @default(TUTORIAL)
  
  // ìˆœì„œ (ìƒí’ˆ í˜ì´ì§€ì—ì„œ í‘œì‹œ ìˆœì„œ)
  sortOrder   Int      @default(0)
  
  createdAt   DateTime @default(now())
  
  @@unique([productId, tutorialId])
  @@index([productId])
  @@index([tutorialId])
}

// ìƒí’ˆ-íŠœí† ë¦¬ì–¼ ì—°ê²° ìœ í˜•
enum ProductTutorialType {
  TUTORIAL        // ì‚¬ìš© ë°©ë²• íŠœí† ë¦¬ì–¼
  MAKING          // ì œì‘ ê³¼ì •
  TIPS            // í™œìš© íŒ
}

model TutorialLike {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  tutorialId  String
  tutorial    Tutorial @relation(fields: [tutorialId], references: [id], onDelete: Cascade)
  createdAt   DateTime @default(now())
  
  @@unique([userId, tutorialId])
  @@index([tutorialId])
}

enum TutorialType {
  TUTORIAL        // íŠœí† ë¦¬ì–¼
  MAKING          // ì œì‘ê¸°
  TIPS            // íŒ & íŠ¸ë¦­
  EXTERNAL        // ì™¸ë¶€ ìë£Œ
}

// ==========================================
// í†µí•© ë°˜ì‘ ì‹œìŠ¤í…œ (Unified Reaction System)
// ==========================================

// ë°˜ì‘ ëŒ€ìƒ ì½˜í…ì¸  ìœ í˜•
enum TargetType {
  PRODUCT         // ìƒí’ˆ
  TUTORIAL        // íŠœí† ë¦¬ì–¼/êµìœ¡ ì½˜í…ì¸ 
  POST            // ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œê¸€
  COMMENT         // ëŒ“ê¸€
}

// ë°˜ì‘ ìœ í˜•
enum ReactionType {
  LIKE            // ì¢‹ì•„ìš”
  RECOMMEND       // ì¶”ì²œ
  HELPFUL         // ë„ì›€ë¨
  BOOKMARK        // ë¶ë§ˆí¬/ì €ì¥
}

// í†µí•© ë°˜ì‘ ëª¨ë¸
model Reaction {
  id          String       @id @default(cuid())
  userId      String
  user        User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  targetType  TargetType   // ëŒ€ìƒ ì½˜í…ì¸  ìœ í˜•
  targetId    String       // ëŒ€ìƒ ì½˜í…ì¸  ID
  type        ReactionType // ë°˜ì‘ ìœ í˜•
  
  createdAt   DateTime     @default(now())
  
  @@unique([userId, targetType, targetId, type])
  @@index([targetType, targetId])
  @@index([userId])
  @@index([type])
}

// í†µí•© ëŒ“ê¸€ ëª¨ë¸
model UnifiedComment {
  id          String      @id @default(cuid())
  userId      String
  user        User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  targetType  TargetType  // ëŒ€ìƒ ì½˜í…ì¸  ìœ í˜•
  targetId    String      // ëŒ€ìƒ ì½˜í…ì¸  ID
  content     String      @db.Text
  
  // ëŒ€ëŒ“ê¸€ ì§€ì›
  parentId    String?
  parent      UnifiedComment?  @relation("CommentReplies", fields: [parentId], references: [id], onDelete: Cascade)
  replies     UnifiedComment[] @relation("CommentReplies")
  
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  
  @@index([targetType, targetId])
  @@index([userId])
  @@index([parentId])
  @@index([createdAt])
}

// ==========================================
// ì •ì‚° ëª¨ë¸
// ==========================================

model Settlement {
  id              String   @id @default(cuid())
  
  // íŒë§¤ì
  sellerId        String
  seller          User     @relation(fields: [sellerId], references: [id], onDelete: Cascade)
  
  // ì •ì‚° ê¸°ê°„
  periodStart     DateTime
  periodEnd       DateTime
  
  // ê¸ˆì•¡ ì •ë³´
  totalSales      Decimal  @db.Decimal(12, 2)  // ì´ íŒë§¤ì•¡
  salesCount      Int      @default(0)          // íŒë§¤ ê±´ìˆ˜
  platformFee     Decimal  @db.Decimal(12, 2)  // í”Œë«í¼ ìˆ˜ìˆ˜ë£Œ (10%)
  paymentFee      Decimal  @db.Decimal(12, 2)  // PG ìˆ˜ìˆ˜ë£Œ (ì•½ 3.5%)
  netAmount       Decimal  @db.Decimal(12, 2)  // ì •ì‚° ê¸ˆì•¡ (ì‹¤ìˆ˜ë ¹ì•¡)
  
  // ìƒíƒœ
  status          SettlementStatus @default(PENDING)
  
  // ì •ì‚° ì²˜ë¦¬ ì •ë³´
  processedAt     DateTime?        // ì •ì‚° ì²˜ë¦¬ì¼
  paidAt          DateTime?        // ì…ê¸ˆ ì™„ë£Œì¼
  transactionId   String?          // ì€í–‰ ê±°ë˜ ID
  
  // ì •ì‚° ê³„ì¢Œ ì •ë³´ (ì •ì‚° ì‹œì  ìŠ¤ëƒ…ìƒ·)
  bankName        String?
  accountNumber   String?
  accountHolder   String?
  
  // ë¹„ê³ 
  notes           String?  @db.Text
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // ì •ì‚°ì— í¬í•¨ëœ êµ¬ë§¤ ë‚´ì—­
  settlementItems SettlementItem[]
  
  @@index([sellerId])
  @@index([status])
  @@index([periodStart, periodEnd])
  @@index([createdAt])
}

// ì •ì‚° ìƒì„¸ í•­ëª© (ì–´ë–¤ êµ¬ë§¤ê°€ ì´ ì •ì‚°ì— í¬í•¨ë˜ì—ˆëŠ”ì§€)
model SettlementItem {
  id            String     @id @default(cuid())
  
  settlementId  String
  settlement    Settlement @relation(fields: [settlementId], references: [id], onDelete: Cascade)
  
  purchaseId    String
  purchase      Purchase   @relation(fields: [purchaseId], references: [id])
  
  // ê¸ˆì•¡ ìŠ¤ëƒ…ìƒ·
  amount        Decimal    @db.Decimal(10, 2)
  platformFee   Decimal    @db.Decimal(10, 2)
  paymentFee    Decimal    @db.Decimal(10, 2)
  netAmount     Decimal    @db.Decimal(10, 2)
  
  createdAt     DateTime   @default(now())
  
  @@unique([settlementId, purchaseId])
  @@index([settlementId])
  @@index([purchaseId])
}

// ==========================================
// í™˜ë¶ˆ ìš”ì²­ ëª¨ë¸
// ==========================================

model RefundRequest {
  id            String   @id @default(cuid())
  
  // ìš”ì²­ì (êµ¬ë§¤ì)
  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // êµ¬ë§¤ ì •ë³´
  purchaseId    String
  purchase      Purchase @relation(fields: [purchaseId], references: [id])
  
  // í™˜ë¶ˆ ê¸ˆì•¡
  amount        Decimal  @db.Decimal(10, 2)
  
  // í™˜ë¶ˆ ì‚¬ìœ 
  reason        RefundReason
  reasonDetail  String?  @db.Text  // ìƒì„¸ ì‚¬ìœ 
  
  // ìƒíƒœ
  status        RefundStatus @default(PENDING)
  
  // ì²˜ë¦¬ ì •ë³´
  processedAt   DateTime?
  processedBy   String?          // ì²˜ë¦¬í•œ ê´€ë¦¬ì ID
  adminNotes    String?  @db.Text // ê´€ë¦¬ì ë©”ëª¨
  
  // Stripe í™˜ë¶ˆ ID
  stripeRefundId String?
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@index([userId])
  @@index([purchaseId])
  @@index([status])
  @@index([createdAt])
}

// ==========================================
// ì •ì‚°/í™˜ë¶ˆ ê´€ë ¨ Enum
// ==========================================

enum SettlementStatus {
  PENDING       // ì •ì‚° ëŒ€ê¸° (í™˜ë¶ˆ ëŒ€ê¸° ê¸°ê°„)
  READY         // ì •ì‚° ì¤€ë¹„ ì™„ë£Œ
  PROCESSING    // ì²˜ë¦¬ ì¤‘
  COMPLETED     // ì •ì‚° ì™„ë£Œ
  FAILED        // ì‹¤íŒ¨
  CANCELLED     // ì·¨ì†Œ
}

enum RefundStatus {
  PENDING       // ê²€í†  ëŒ€ê¸°
  REVIEWING     // ê²€í†  ì¤‘
  APPROVED      // ìŠ¹ì¸ (í™˜ë¶ˆ ì²˜ë¦¬ ì¤‘)
  COMPLETED     // í™˜ë¶ˆ ì™„ë£Œ
  REJECTED      // ê±°ì ˆ
  CANCELLED     // ì·¨ì†Œ
}

enum RefundReason {
  PRODUCT_MISMATCH    // ìƒí’ˆ ì„¤ëª…ê³¼ ë‹¤ë¦„
  DOWNLOAD_ISSUE      // ë‹¤ìš´ë¡œë“œ ë¶ˆê°€
  DUPLICATE_PURCHASE  // ì¤‘ë³µ ê²°ì œ
  COPYRIGHT_ISSUE     // ì €ì‘ê¶Œ ë¬¸ì œ
  TECHNICAL_ISSUE     // ê¸°ìˆ ì  ë¬¸ì œ
  OTHER               // ê¸°íƒ€
}

// ==========================================
// ìƒí’ˆ ë²ˆë“¤ ëª¨ë¸
// ==========================================

model Bundle {
  id              String   @id @default(cuid())
  
  // ê¸°ë³¸ ì •ë³´
  title           String
  slug            String   @unique
  description     String   @db.Text
  
  // íŒë§¤ì
  sellerId        String
  
  // ê°€ê²© ì •ë³´
  originalPrice   Decimal  @db.Decimal(10, 2)  // ê°œë³„ êµ¬ë§¤ ì‹œ ì´í•©
  bundlePrice     Decimal  @db.Decimal(10, 2)  // ë²ˆë“¤ ê°€ê²©
  discountPercent Int      @default(0)          // í• ì¸ìœ¨ (%)
  
  // ë¯¸ë””ì–´
  thumbnail       String?
  
  // ìƒíƒœ
  isActive        Boolean  @default(true)
  startDate       DateTime?                     // íŒë§¤ ì‹œì‘ì¼
  endDate         DateTime?                     // íŒë§¤ ì¢…ë£Œì¼
  
  // í†µê³„
  salesCount      Int      @default(0)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // ê´€ê³„
  items           BundleItem[]
  purchases       BundlePurchase[]
  
  @@index([sellerId])
  @@index([slug])
  @@index([isActive])
}

model BundleItem {
  id          String   @id @default(cuid())
  
  bundleId    String
  bundle      Bundle   @relation(fields: [bundleId], references: [id], onDelete: Cascade)
  
  productId   String
  
  sortOrder   Int      @default(0)
  
  createdAt   DateTime @default(now())
  
  @@unique([bundleId, productId])
  @@index([bundleId])
  @@index([productId])
}

model BundlePurchase {
  id            String   @id @default(cuid())
  
  buyerId       String
  bundleId      String
  bundle        Bundle   @relation(fields: [bundleId], references: [id])
  
  // ê²°ì œ ì •ë³´
  amount        Decimal  @db.Decimal(10, 2)
  currency      String   @default("KRW")
  paymentMethod String?
  paymentId     String?
  
  // ìƒíƒœ
  status        PurchaseStatus @default(PENDING)
  
  // ì ìš©ëœ ì¿ í°
  couponId      String?
  coupon        Coupon?  @relation(fields: [couponId], references: [id])
  discountAmount Decimal? @db.Decimal(10, 2)
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@unique([buyerId, bundleId])
  @@index([buyerId])
  @@index([bundleId])
  @@index([status])
}

// ==========================================
// ì¿ í°/í• ì¸ ì‹œìŠ¤í…œ ëª¨ë¸
// ==========================================

model Coupon {
  id              String   @id @default(cuid())
  
  // ì¿ í° ì½”ë“œ
  code            String   @unique
  
  // ê¸°ë³¸ ì •ë³´
  name            String
  description     String?
  
  // í• ì¸ ìœ í˜•
  discountType    DiscountType @default(PERCENTAGE)
  discountValue   Decimal  @db.Decimal(10, 2)  // ê¸ˆì•¡ ë˜ëŠ” %
  
  // ìµœì†Œ ì£¼ë¬¸ ê¸ˆì•¡
  minOrderAmount  Decimal? @db.Decimal(10, 2)
  
  // ìµœëŒ€ í• ì¸ ê¸ˆì•¡ (% í• ì¸ ì‹œ)
  maxDiscountAmount Decimal? @db.Decimal(10, 2)
  
  // ì‚¬ìš© ì œí•œ
  usageLimit      Int?                         // ì „ì²´ ì‚¬ìš© ê°€ëŠ¥ íšŸìˆ˜
  usageLimitPerUser Int?    @default(1)        // ìœ ì €ë‹¹ ì‚¬ìš© ê°€ëŠ¥ íšŸìˆ˜
  usedCount       Int      @default(0)         // í˜„ì¬ ì‚¬ìš©ëœ íšŸìˆ˜
  
  // ìœ íš¨ ê¸°ê°„
  startDate       DateTime @default(now())
  endDate         DateTime?
  
  // ì ìš© ëŒ€ìƒ
  applicableType  CouponApplicableType @default(ALL)
  applicableIds   String[]                     // íŠ¹ì • ìƒí’ˆ/ì¹´í…Œê³ ë¦¬ ID ëª©ë¡
  
  // ë°œí–‰ì (íŒë§¤ì ì¿ í° ë˜ëŠ” í”Œë«í¼ ì¿ í°)
  sellerId        String?                      // nullì´ë©´ í”Œë«í¼ ì¿ í°
  
  // ìƒíƒœ
  isActive        Boolean  @default(true)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // ê´€ê³„
  usages          CouponUsage[]
  bundlePurchases BundlePurchase[]
  
  @@index([code])
  @@index([sellerId])
  @@index([isActive])
  @@index([startDate, endDate])
}

model CouponUsage {
  id          String   @id @default(cuid())
  
  couponId    String
  coupon      Coupon   @relation(fields: [couponId], references: [id], onDelete: Cascade)
  
  userId      String
  
  // ì ìš©ëœ ì£¼ë¬¸
  orderId     String?                          // Purchase ID ë˜ëŠ” BundlePurchase ID
  orderType   String?                          // "PRODUCT" ë˜ëŠ” "BUNDLE"
  
  // í• ì¸ ê¸ˆì•¡
  discountAmount Decimal @db.Decimal(10, 2)
  
  createdAt   DateTime @default(now())
  
  @@unique([couponId, userId, orderId])
  @@index([couponId])
  @@index([userId])
}

enum DiscountType {
  PERCENTAGE      // í¼ì„¼íŠ¸ í• ì¸
  FIXED_AMOUNT    // ê³ ì • ê¸ˆì•¡ í• ì¸
}

enum CouponApplicableType {
  ALL             // ëª¨ë“  ìƒí’ˆ
  PRODUCTS        // íŠ¹ì • ìƒí’ˆ
  CATEGORIES      // íŠ¹ì • ì¹´í…Œê³ ë¦¬
  SELLER          // íŠ¹ì • íŒë§¤ìì˜ ìƒí’ˆ
}

// ==========================================
// êµ¬ë… í”Œëœ ë° êµ¬ë… ëª¨ë¸
// ==========================================

enum SubscriptionPlanInterval {
  MONTHLY         // ì›”ê°„
  YEARLY          // ì—°ê°„
}

enum SubscriptionStatus {
  ACTIVE          // í™œì„±
  PAUSED          // ì¼ì‹œì •ì§€
  CANCELLED       // ì·¨ì†Œë¨
  EXPIRED         // ë§Œë£Œë¨
  PAST_DUE        // ê²°ì œ ì—°ì²´
}

enum PaymentRetryStatus {
  PENDING         // ëŒ€ê¸°ì¤‘
  RETRYING        // ì¬ì‹œë„ì¤‘
  SUCCEEDED       // ì„±ê³µ
  FAILED          // ìµœì¢… ì‹¤íŒ¨
}

// êµ¬ë… í”Œëœ (íŒë§¤ìê°€ ìƒì„±)
model SubscriptionPlan {
  id              String   @id @default(cuid())
  
  // í”Œëœ ê¸°ë³¸ ì •ë³´
  name            String
  description     String?  @db.Text
  slug            String   @unique
  
  // ê°€ê²© ì •ë³´
  price           Decimal  @db.Decimal(10, 2)
  currency        String   @default("KRW")
  interval        SubscriptionPlanInterval @default(MONTHLY)
  
  // í˜œíƒ
  features        String[] // í”Œëœ í˜œíƒ ëª©ë¡
  downloadLimit   Int?     // ì›”ê°„ ë‹¤ìš´ë¡œë“œ ì œí•œ (null = ë¬´ì œí•œ)
  accessLevel     Int      @default(1) // ì ‘ê·¼ ë ˆë²¨ (1=ê¸°ë³¸, 2=í”„ë¦¬ë¯¸ì—„, 3=í”„ë¡œ)
  
  // í¬í•¨ëœ ìƒí’ˆ/ì»¬ë ‰ì…˜
  includedProductIds String[] // êµ¬ë…ì— í¬í•¨ëœ ìƒí’ˆ ID ëª©ë¡
  includedCollectionIds String[] // êµ¬ë…ì— í¬í•¨ëœ ì»¬ë ‰ì…˜ ID ëª©ë¡
  
  // íŠ¸ë¼ì´ì–¼ ê¸°ê°„
  trialDays       Int      @default(0)
  
  // íŒë§¤ì
  sellerId        String?  // nullì´ë©´ í”Œë«í¼ í”Œëœ
  seller          User?    @relation("SellerSubscriptionPlans", fields: [sellerId], references: [id])
  
  // ìƒíƒœ
  isActive        Boolean  @default(true)
  isPublic        Boolean  @default(true)
  
  // í†µê³„
  subscriberCount Int      @default(0)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // ê´€ê³„
  subscriptions   Subscription[]
  
  @@index([sellerId])
  @@index([isActive, isPublic])
  @@index([slug])
}

// ì‚¬ìš©ì êµ¬ë…
model Subscription {
  id              String   @id @default(cuid())
  
  // êµ¬ë…ì
  userId          String
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // êµ¬ë… í”Œëœ
  planId          String
  plan            SubscriptionPlan @relation(fields: [planId], references: [id])
  
  // ê²°ì œ ì •ë³´ (ë¶€íŠ¸í˜ì´ ë¹Œë§í‚¤)
  billingKey      String?  // ë¶€íŠ¸í˜ì´ ë¹Œë§í‚¤
  paymentMethod   String?  // ê²°ì œ ìˆ˜ë‹¨
  
  // êµ¬ë… ê¸°ê°„
  currentPeriodStart DateTime
  currentPeriodEnd   DateTime
  
  // íŠ¸ë¼ì´ì–¼
  trialStart      DateTime?
  trialEnd        DateTime?
  isTrialUsed     Boolean  @default(false)
  
  // ìƒíƒœ
  status          SubscriptionStatus @default(ACTIVE)
  cancelledAt     DateTime?
  cancelReason    String?
  
  // ë‹¤ìŒ ê²°ì œ
  nextBillingDate DateTime?
  lastBillingDate DateTime?
  
  // í†µê³„
  totalPaid       Decimal  @default(0) @db.Decimal(10, 2)
  paymentCount    Int      @default(0)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // ê´€ê³„
  payments        SubscriptionPayment[]
  paymentRetries  PaymentRetry[]
  
  @@unique([userId, planId])
  @@index([userId])
  @@index([planId])
  @@index([status])
  @@index([nextBillingDate])
}

// êµ¬ë… ê²°ì œ ë‚´ì—­
model SubscriptionPayment {
  id              String   @id @default(cuid())
  
  subscriptionId  String
  subscription    Subscription @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)
  
  // ê²°ì œ ì •ë³´
  amount          Decimal  @db.Decimal(10, 2)
  currency        String   @default("KRW")
  paymentMethod   String?
  
  // ì™¸ë¶€ ê²°ì œ ì‹œìŠ¤í…œ ì •ë³´
  receiptId       String?  // ë¶€íŠ¸í˜ì´ ì˜ìˆ˜ì¦ ID
  orderId         String?  // ì£¼ë¬¸ ID
  
  // ê²°ì œ ê¸°ê°„
  periodStart     DateTime
  periodEnd       DateTime
  
  // ìƒíƒœ
  status          String   @default("COMPLETED") // COMPLETED, FAILED, REFUNDED
  failedReason    String?
  
  // í™˜ë¶ˆ ì •ë³´
  refundedAt      DateTime?
  refundAmount    Decimal? @db.Decimal(10, 2)
  
  createdAt       DateTime @default(now())
  
  @@index([subscriptionId])
  @@index([status])
  @@index([createdAt])
}

// ê²°ì œ ì¬ì‹œë„ ë¡œê·¸
model PaymentRetry {
  id              String   @id @default(cuid())
  
  subscriptionId  String
  subscription    Subscription @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)
  
  // ì¬ì‹œë„ ì •ë³´
  attemptNumber   Int      @default(1)
  maxAttempts     Int      @default(3)
  
  // ê²°ì œ ì‹œë„ ì •ë³´
  amount          Decimal  @db.Decimal(10, 2)
  
  // ìƒíƒœ
  status          PaymentRetryStatus @default(PENDING)
  errorMessage    String?
  receiptId       String?  // ì„±ê³µ ì‹œ ì˜ìˆ˜ì¦ ID
  
  // ìŠ¤ì¼€ì¤„
  scheduledAt     DateTime // ì¬ì‹œë„ ì˜ˆì • ì‹œê°„
  processedAt     DateTime? // ì‹¤ì œ ì²˜ë¦¬ ì‹œê°„
  
  // ì•Œë¦¼ ë°œì†¡ ì—¬ë¶€
  notificationSent Boolean @default(false)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@index([subscriptionId])
  @@index([status])
  @@index([scheduledAt])
}

// ==========================================
// ğŸ§  ë² ì´ì§€ì•ˆ ìë™ ì§„í™” ì¶”ì²œ ì‹œìŠ¤í…œ
// ==========================================

// ì‚¬ìš©ì í´ëŸ¬ìŠ¤í„° ìœ í˜•
enum UserClusterType {
  PRICE_SENSITIVE      // ê°€ê²© ë¯¼ê°í˜•
  CONVENIENCE_FOCUSED  // í¸ì˜ ì¤‘ì‹œí˜•
  QUALITY_SEEKER       // í’ˆì§ˆ ì¶”êµ¬í˜•
  BRAND_LOYAL          // ë¸Œëœë“œ ì¶©ì„±í˜•
  IMPULSE_BUYER        // ì¶©ë™ êµ¬ë§¤í˜•
  UNKNOWN              // ë¯¸ë¶„ë¥˜
}

// í”¼ë“œë°± ìœ í˜•
enum RecommendationFeedbackType {
  EXPOSURE     // ë…¸ì¶œë¨
  CLICK        // í´ë¦­
  CART         // ì¥ë°”êµ¬ë‹ˆ
  WISHLIST     // ìœ„ì‹œë¦¬ìŠ¤íŠ¸
  PURCHASE     // êµ¬ë§¤
  SKIP         // ìŠ¤í‚µ
  RETURN       // ë°˜í’ˆ
}

// ì‚¬ìš©ì í´ëŸ¬ìŠ¤í„° ìƒíƒœ
model UserCluster {
  id              String          @id @default(cuid())
  userId          String          @unique
  user            User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // í´ëŸ¬ìŠ¤í„° ë¶„ë¥˜
  cluster         UserClusterType @default(UNKNOWN)
  confidence      Float           @default(0) // ë¶„ë¥˜ ì‹ ë¢°ë„ (0-1)
  
  // íŠ¹ì„± ë²¡í„° (ì •ê·œí™”ëœ ê°’ë“¤)
  avgPrice        Float           @default(0)    // í‰ê·  êµ¬ë§¤ ê°€ê²©
  purchaseFreq    Float           @default(0)    // êµ¬ë§¤ ë¹ˆë„
  reviewRate      Float           @default(0)    // ë¦¬ë·° ì‘ì„±ë¥ 
  returnRate      Float           @default(0)    // ë°˜í’ˆë¥ 
  diversityScore  Float           @default(0)    // ì¹´í…Œê³ ë¦¬ ë‹¤ì–‘ì„±
  
  // ì²« êµ¬ë§¤ ì •ë³´
  firstProductId  String?
  firstCategory   String?
  
  // í´ëŸ¬ìŠ¤í„°ë³„ í™•ë¥  ë¶„í¬
  clusterProbs    Json            @default("{}") // {cluster: probability}
  
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  
  @@index([cluster])
  @@index([confidence])
}

// ì¡°ê±´ë¶€ í™•ë¥  ì „ì´ í–‰ë ¬
model TransitionMatrix {
  id              String          @id @default(cuid())
  
  // í‚¤: first_product:cluster
  firstProductId  String
  cluster         UserClusterType
  
  // ë‹¤ìŒ ìƒí’ˆìœ¼ë¡œì˜ ì „ì´ í™•ë¥ 
  nextProductId   String
  transitionCount Int             @default(0) // ì „ì´ íšŸìˆ˜
  totalFromFirst  Int             @default(0) // ì²« ìƒí’ˆì—ì„œ ì¶œë°œí•œ ì´ íšŸìˆ˜
  probability     Float           @default(0) // ê³„ì‚°ëœ í™•ë¥ 
  
  // ë¼í”Œë¼ìŠ¤ ìŠ¤ë¬´ë”© ì ìš© í™•ë¥ 
  smoothedProb    Float           @default(0)
  
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  
  @@unique([firstProductId, cluster, nextProductId])
  @@index([firstProductId, cluster])
  @@index([nextProductId])
  @@index([probability])
}

// ì¹´í…Œê³ ë¦¬ ì „ì´ í–‰ë ¬
model CategoryTransition {
  id              String          @id @default(cuid())
  
  fromCategory    String
  toCategory      String
  cluster         UserClusterType
  
  transitionCount Int             @default(0)
  probability     Float           @default(0)
  
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  
  @@unique([fromCategory, toCategory, cluster])
  @@index([fromCategory, cluster])
  @@index([probability])
}

// í­í¬ í¼ë„ ìƒíƒœ (5ë‹¨ê³„)
model FunnelState {
  id              String          @id @default(cuid())
  
  productId       String
  cluster         UserClusterType
  
  // 5ë‹¨ê³„ ì „í™˜ìœ¨
  exposureRate    Float           @default(1.0)  // ë…¸ì¶œ
  awarenessRate   Float           @default(0.8)  // ì¸ì§€
  interestRate    Float           @default(0.5)  // ê´€ì‹¬
  desireRate      Float           @default(0.3)  // ìš•êµ¬
  actionRate      Float           @default(0.2)  // í–‰ë™
  conversionRate  Float           @default(0.1)  // ìµœì¢… ì „í™˜
  
  // ëˆ„ì  í†µê³„
  totalExposures  Int             @default(0)
  totalActions    Int             @default(0)
  
  // í˜ë„í‹° (ì‹¤íŒ¨ë¡œ ì¸í•œ ì¡°ì •)
  exposurePenalty Float           @default(0)
  awarenessPenalty Float          @default(0)
  interestPenalty Float           @default(0)
  desirePenalty   Float           @default(0)
  actionPenalty   Float           @default(0)
  
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  
  @@unique([productId, cluster])
  @@index([conversionRate])
}

// ì¶”ì²œ í”¼ë“œë°± ë¡œê·¸
model RecommendationFeedback {
  id              String                      @id @default(cuid())
  
  userId          String
  productId       String
  
  // í”¼ë“œë°± ì •ë³´
  feedbackType    RecommendationFeedbackType
  feedbackValue   Float                       @default(0) // 0-1 ì—°ì†ê°’
  
  // ì¶”ì²œ ì»¨í…ìŠ¤íŠ¸
  recommendedAt   DateTime
  feedbackAt      DateTime                    @default(now())
  responseTime    Int?                        // ë°˜ì‘ ì‹œê°„ (ì´ˆ)
  
  // ì¶”ì²œ ë‹¹ì‹œ ì •ë³´
  predictedProb   Float                       @default(0) // ì˜ˆì¸¡ í™•ë¥ 
  actualOutcome   Boolean?                    // ì‹¤ì œ ì „í™˜ ì—¬ë¶€
  
  // ì‹¤íŒ¨ ì‹œ ë‹¨ê³„ ì¶”ì 
  failedStage     String?                     // ì‹¤íŒ¨ ë‹¨ê³„ (awareness, interest ë“±)
  
  // ë§¥ë½ ì •ë³´
  context         Json                        @default("{}") // {hour, device, discount, etc}
  
  createdAt       DateTime                    @default(now())
  
  @@index([userId])
  @@index([productId])
  @@index([feedbackType])
  @@index([recommendedAt])
}

// ì¶”ì²œ ì‹œìŠ¤í…œ ê¸€ë¡œë²Œ ìƒíƒœ
model RecommendationState {
  id              String          @id @default(cuid())
  key             String          @unique // ìƒíƒœ í‚¤
  
  // JSON í˜•íƒœë¡œ ì €ì¥ë˜ëŠ” ìƒíƒœ ë°ì´í„°
  value           Json
  
  // ë©”íƒ€ ì •ë³´
  version         Int             @default(1)
  
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  
  @@index([key])
}

// ì¶”ì²œ ì‹œìŠ¤í…œ í†µê³„
model RecommendationStats {
  id                  String      @id @default(cuid())
  
  // ê¸°ê°„
  date                DateTime    @db.Date
  hour                Int?        // nullì´ë©´ ì¼ê°„, ìˆìœ¼ë©´ ì‹œê°„ë³„
  
  // ì¶”ì²œ í†µê³„
  totalRecommendations Int        @default(0)
  totalConversions    Int         @default(0)
  conversionRate      Float       @default(0)
  
  // ì¬ë¬´ í†µê³„
  totalRevenue        Decimal     @default(0) @db.Decimal(12, 2)
  totalCost           Decimal     @default(0) @db.Decimal(12, 2) // ì¶”ì²œ ë¹„ìš© (í• ì¸ ë“±)
  netProfit           Decimal     @default(0) @db.Decimal(12, 2)
  roi                 Float       @default(0)
  
  // í´ëŸ¬ìŠ¤í„°ë³„ ì„±ê³¼
  clusterStats        Json        @default("{}") // {cluster: {conversions, revenue}}
  
  // ìƒìœ„ ì¶”ì²œ ìƒí’ˆ
  topProducts         Json        @default("[]") // [{productId, conversions, revenue}]
  
  createdAt           DateTime    @default(now())
  updatedAt           DateTime    @updatedAt
  
  @@unique([date, hour])
  @@index([date])
}

// ==========================================
// A/B í…ŒìŠ¤íŠ¸ ì‹œìŠ¤í…œ
// ==========================================

enum ExperimentStatus {
  DRAFT       // ì´ˆì•ˆ
  RUNNING     // ì‹¤í–‰ ì¤‘
  PAUSED      // ì¼ì‹œ ì •ì§€
  COMPLETED   // ì™„ë£Œ
  ARCHIVED    // ë³´ê´€ë¨
}

// A/B í…ŒìŠ¤íŠ¸ ì‹¤í—˜
model Experiment {
  id                String            @id @default(cuid())
  
  // ê¸°ë³¸ ì •ë³´
  name              String            // ì‹¤í—˜ ì´ë¦„
  description       String?           @db.Text
  hypothesis        String?           @db.Text // ê°€ì„¤
  
  // ìƒíƒœ
  status            ExperimentStatus  @default(DRAFT)
  
  // ì‹¤í—˜ ëŒ€ìƒ
  targetType        String            // 'page', 'component', 'feature', 'api'
  targetKey         String            // ëŒ€ìƒ ì‹ë³„ì (ì˜ˆ: '/marketplace', 'cta-button')
  
  // íŠ¸ë˜í”½ ì„¤ì •
  trafficPercentage Int               @default(100) // ì „ì²´ íŠ¸ë˜í”½ ì¤‘ ì‹¤í—˜ ëŒ€ìƒ ë¹„ìœ¨
  
  // ê¸°ê°„
  startDate         DateTime?
  endDate           DateTime?
  
  // ëª©í‘œ ì§€í‘œ
  primaryMetric     String            @default("conversion") // conversion, click, revenue, engagement
  secondaryMetrics  String[]          @default([])
  
  // í†µê³„ ì„¤ì •
  minSampleSize     Int               @default(1000) // ìµœì†Œ ìƒ˜í”Œ ìˆ˜
  confidenceLevel   Float             @default(0.95)  // ì‹ ë¢° ìˆ˜ì¤€ (95%)
  
  // ê´€ê³„
  variants          ExperimentVariant[]
  assignments       ExperimentAssignment[]
  events            ExperimentEvent[]
  
  // ê²°ê³¼
  winnerVariantId   String?           // ìŠ¹ì ë³€í˜• ID
  conclusion        String?           @db.Text // ê²°ë¡ 
  
  // ìƒì„±ì
  createdById       String?
  createdBy         User?             @relation(fields: [createdById], references: [id])
  
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  
  @@index([status])
  @@index([targetType, targetKey])
  @@index([createdById])
}

// ì‹¤í—˜ ë³€í˜• (A, B, C...)
model ExperimentVariant {
  id              String            @id @default(cuid())
  
  experimentId    String
  experiment      Experiment        @relation(fields: [experimentId], references: [id], onDelete: Cascade)
  
  // ë³€í˜• ì •ë³´
  name            String            // ì˜ˆ: 'Control', 'Variant A', 'Variant B'
  description     String?
  isControl       Boolean           @default(false) // ëŒ€ì¡°êµ° ì—¬ë¶€
  
  // íŠ¸ë˜í”½ ê°€ì¤‘ì¹˜
  weight          Int               @default(50) // ë³€í˜•ë³„ íŠ¸ë˜í”½ ë¹„ìœ¨ (í•©ê³„ 100)
  
  // ë³€í˜• ì„¤ì •
  config          Json              @default("{}") // ë³€í˜•ë³„ ì„¤ì •ê°’
  
  // ê´€ê³„
  assignments     ExperimentAssignment[]
  events          ExperimentEvent[]
  
  // í†µê³„ (ìºì‹±ìš©)
  totalUsers      Int               @default(0)
  conversions     Int               @default(0)
  conversionRate  Float             @default(0)
  totalRevenue    Decimal           @default(0) @db.Decimal(12, 2)
  
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  
  @@index([experimentId])
}

// ì‚¬ìš©ì-ì‹¤í—˜ í• ë‹¹
model ExperimentAssignment {
  id              String            @id @default(cuid())
  
  experimentId    String
  experiment      Experiment        @relation(fields: [experimentId], references: [id], onDelete: Cascade)
  
  variantId       String
  variant         ExperimentVariant @relation(fields: [variantId], references: [id], onDelete: Cascade)
  
  // ì‚¬ìš©ì ì‹ë³„ (ë¡œê·¸ì¸ ë˜ëŠ” ìµëª…)
  userId          String?           // ë¡œê·¸ì¸ ì‚¬ìš©ì
  sessionId       String?           // ìµëª… ì‚¬ìš©ì ì„¸ì…˜
  
  // í• ë‹¹ ì‹œì 
  assignedAt      DateTime          @default(now())
  
  // ì „í™˜ ì—¬ë¶€
  converted       Boolean           @default(false)
  convertedAt     DateTime?
  
  @@unique([experimentId, userId])
  @@unique([experimentId, sessionId])
  @@index([experimentId, variantId])
  @@index([userId])
  @@index([sessionId])
}

// ì‹¤í—˜ ì´ë²¤íŠ¸ ë¡œê·¸
model ExperimentEvent {
  id              String            @id @default(cuid())
  
  experimentId    String
  experiment      Experiment        @relation(fields: [experimentId], references: [id], onDelete: Cascade)
  
  variantId       String
  variant         ExperimentVariant @relation(fields: [variantId], references: [id], onDelete: Cascade)
  
  // ì‚¬ìš©ì ì‹ë³„
  userId          String?
  sessionId       String?
  
  // ì´ë²¤íŠ¸ ì •ë³´
  eventType       String            // 'view', 'click', 'conversion', 'revenue'
  eventValue      Float?            // ìˆ˜ì¹˜ (ì˜ˆ: ë§¤ì¶œì•¡)
  metadata        Json              @default("{}")
  
  // ì‹œê°„
  timestamp       DateTime          @default(now())
  
  @@index([experimentId, variantId])
  @@index([experimentId, eventType])
  @@index([timestamp])
}
